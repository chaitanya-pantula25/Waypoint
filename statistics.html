<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Statistics - Waypoint</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <div class="logo" onclick="window.location.href='index.html'">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <path d="M16 2L20 12L30 14L22 22L24 32L16 26L8 32L10 22L2 14L12 12L16 2Z" fill="currentColor"/>
                    </svg>
                    <span>Waypoint</span>
                </div>
            </div>
            <div class="nav-center">
                <div class="search-bar">
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                        <path d="M12.5 11H11.71L11.43 10.73C12.41 9.59 13 8.11 13 6.5C13 2.91 10.09 0 6.5 0C2.91 0 0 2.91 0 6.5C0 10.09 2.91 13 6.5 13C8.11 13 9.59 12.41 10.73 11.43L11 11.71V12.5L16 17.49L17.49 16L12.5 11ZM6.5 11C4.01 11 2 8.99 2 6.5C2 4.01 4.01 2 6.5 2C8.99 2 11 4.01 11 6.5C11 8.99 8.99 11 6.5 11Z" fill="currentColor"/>
                    </svg>
                    <input type="text" id="searchInput" placeholder="Search treks...">
                </div>
            </div>
            <div class="nav-right">
                <button class="nav-btn" onclick="window.location.href='discover.html'">Discover</button>
                <button class="nav-btn" onclick="window.location.href='add-trek.html'">Add your treks</button>
                <button class="nav-btn" onclick="window.location.href='plan-trek.html'">Plan a trek</button>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM10 18C5.59 18 2 14.41 2 10C2 5.59 5.59 2 10 2C14.41 2 18 5.59 18 10C18 14.41 14.41 18 10 18Z" fill="currentColor"/>
                    </svg>
                </button>
                <div id="authSection"></div>
            </div>
        </div>
    </nav>

    <div class="page-container">
        <h1 class="page-title">My Statistics</h1>

        <div class="stats-grid" id="statsGrid">
            <!-- Statistics will be populated here -->
        </div>

        <div style="margin-top: 3rem;">
            <h2 style="margin-bottom: 1.5rem; color: var(--text);">Completed Treks</h2>
            <div id="completedTreksList" style="display: grid; gap: 1rem;">
                <!-- Completed treks will be listed here -->
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        WaypointApp.loadData();
        WaypointApp.checkAuth();
        WaypointApp.updateAuthUI();

        // Check if user is logged in
        if (!WaypointApp.AppState.currentUser) {
            alert('Please log in to view statistics');
            window.location.href = 'auth.html';
        }

        // Load and display statistics
        const stats = WaypointApp.getUserStatistics();
        
        const statsGrid = document.getElementById('statsGrid');
        statsGrid.innerHTML = `
            <div class="stat-box">
                <div class="stat-box-icon">üìè</div>
                <div class="stat-box-value">${stats.totalDistance.toFixed(1)}</div>
                <div class="stat-box-label">Total Distance (km)</div>
            </div>
            <div class="stat-box">
                <div class="stat-box-icon">‚õ∞Ô∏è</div>
                <div class="stat-box-value">${stats.totalElevation}</div>
                <div class="stat-box-label">Total Elevation Gain (m)</div>
            </div>
            <div class="stat-box">
                <div class="stat-box-icon">üèîÔ∏è</div>
                <div class="stat-box-value">${stats.totalTreks}</div>
                <div class="stat-box-label">Total Treks Completed</div>
            </div>
            <div class="stat-box">
                <div class="stat-box-icon">‚è±Ô∏è</div>
                <div class="stat-box-value">${stats.totalTime}</div>
                <div class="stat-box-label">Total Time (hours)</div>
            </div>
        `;

        // Display completed treks
        const completedTrekIds = WaypointApp.AppState.completedTreks;
        const allTreks = WaypointApp.getAllTreks();
        const completedTreks = allTreks.filter(trek => completedTrekIds.includes(trek.id));

        const completedTreksList = document.getElementById('completedTreksList');
        if (completedTreks.length === 0) {
            completedTreksList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 2rem;">No completed treks yet. Start exploring!</p>';
        } else {
            completedTreksList.innerHTML = completedTreks.map(trek => `
                <div class="trek-card" onclick="window.location.href='trek-detail.html?id=${trek.id}'">
                    <h3>${trek.name}</h3>
                    <div class="trek-info">
                        <div class="trek-info-item">
                            <span>üìç</span>
                            <span>${trek.location}</span>
                        </div>
                        <div class="trek-info-item">
                            <span>üìè</span>
                            <span>${trek.distance} km</span>
                        </div>
                        <div class="trek-info-item">
                            <span>‚õ∞Ô∏è</span>
                            <span>${trek.elevation} m</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const query = searchInput.value.trim();
                if (query) {
                    window.location.href = `discover.html?search=${encodeURIComponent(query)}`;
                }
            }
        });

        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', WaypointApp.toggleTheme);
        }
    </script>
</body>
</html>
